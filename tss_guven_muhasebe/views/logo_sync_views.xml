<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Logo Sync Wizard Form View -->
    <record id="view_logo_sync_wizard_form" model="ir.ui.view">
        <field name="name">logo.sync.wizard.form</field>
        <field name="model">logo.sync.wizard</field>
        <field name="arch" type="xml">
            <form string="Logo MSSQL Senkronizasyonu">
                <div class="alert alert-info" role="alert" style="margin-bottom: 16px;">
                    <strong>Logo Senkronizasyonu:</strong> Bu araÃ§ e-fatura kayÄ±tlarÄ±nÄ±zÄ± Logo MSSQL veritabanÄ±yla karÅŸÄ±laÅŸtÄ±rÄ±r ve 
                    gerekli alanlarÄ±nÄ± gÃ¼nceller.
                    <br/><br/>
                    <strong>Not:</strong> MSSQL baÄŸlantÄ± ayarlarÄ± modÃ¼l yapÄ±landÄ±rmasÄ±ndan alÄ±nÄ±r. 
                    AyarlarÄ± deÄŸiÅŸtirmek iÃ§in E-Fatura â†’ YapÄ±landÄ±rma menÃ¼sÃ¼nÃ¼ kullanÄ±n.
                </div>
                
                <group>
                    <group string="Senkronizasyon AyarlarÄ±">
                        <field name="sync_mode"/>
                        <field name="direction_filter"/>
                        <field name="test_mode"/>
                    </group>
                    
                    <group string="Tarih Filtresi" invisible="sync_mode == 'selected'">
                        <field name="date_filter"/>
                        <div class="row" invisible="not date_filter">
                            <div class="col-6">
                                <field name="date_from" required="date_filter"/>
                            </div>
                            <div class="col-6">
                                <field name="date_to" required="date_filter"/>
                            </div>
                        </div>
                    </group>
                </group>
                
                <!-- SonuÃ§ GÃ¶sterimi -->
                <group string="SonuÃ§" invisible="not result_message">
                    <field name="result_message" widget="text" readonly="1" 
                           style="font-family: monospace; white-space: pre-wrap;"/>
                </group>
                
                <footer>
                    <button name="action_test_connection" string="ðŸ”— BaÄŸlantÄ±yÄ± Test Et" 
                            type="object" class="btn-secondary"/>
                    <button name="action_sync_logo" string="ðŸ”„ Senkronize Et" 
                            type="object" class="btn-primary"
                            data-hotkey="shift+enter"
                            confirm="Bu iÅŸlem e-fatura kayÄ±tlarÄ±nÄ±zÄ± gÃ¼nceller. Devam etmek istediÄŸinizden emin misiniz?"/>
                    <button string="Ä°ptal" class="btn-secondary" special="cancel" data-hotkey="x"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Logo Sync Wizard Action -->
    <record id="action_logo_sync_wizard" model="ir.actions.act_window">
        <field name="name">Logo Senkronizasyonu</field>
        <field name="res_model">logo.sync.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

    <!-- E-Invoice Form View'a Buton Ekleme -->
    <record id="view_e_invoice_form_logo_sync" model="ir.ui.view">
        <field name="name">e.invoice.form.logo.sync</field>
        <field name="model">e.invoice</field>
        <field name="inherit_id" ref="view_e_invoice_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <header>
                    <button name="action_sync_single_with_logo" string="Logo ile Senkronize Et" 
                            type="object" class="btn-secondary"/>
                </header>
            </xpath>
            
            <!-- Logo bilgilerini TAB-3 (Notlar ve Kilit) sekmesine ekle -->
            <xpath expr="//page[@name='notlar_kilit']" position="inside">
                <group string="Logo Entegrasyonu" name="logo_info">
                    <field name="exists_in_logo" widget="boolean_button" readonly="1"/>
                    <field name="logo_record_id" readonly="1"/>
                </group>
            </xpath>
        </field>
    </record>

    <!-- E-Invoice List View Logo Sync Extension - DISABLED (exists_in_logo already in base view v3) -->
    <!--
    <record id="view_e_invoice_list_logo_sync_v2" model="ir.ui.view">
        <field name="name">e.invoice.list.logo.sync.v2</field>
        <field name="model">e.invoice</field>
        <field name="inherit_id" ref="view_e_invoice_list_v3"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='gvn_active']" position="after">
                <field name="exists_in_logo" widget="boolean_toggle" readonly="1"/>
            </xpath>
        </field>
    </record>
    -->

    <!-- Server Action for Multi-Record Sync (Odoo 18 Compatible) -->
    <record id="server_action_logo_sync_multi" model="ir.actions.server">
        <field name="name">Logo ile Senkronize Et</field>
        <field name="model_id" ref="model_e_invoice"/>
        <field name="binding_model_id" ref="model_e_invoice"/>
        <field name="binding_view_types">list</field>
        <field name="state">code</field>
        <field name="code">
if records:
    action = records[0].action_open_logo_sync_wizard()
    action['context'].update({
        'active_ids': records.ids,
        'default_sync_mode': 'selected'
    })
        </field>
    </record>

    <!-- Configuration View with Logo MSSQL Settings -->
    <record id="view_e_invoice_config_form" model="ir.ui.view">
        <field name="name">res.config.settings.e.invoice</field>
        <field name="model">res.config.settings</field>
        <field name="inherit_id" ref="base.res_config_settings_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="inside">
                <div class="app_settings_block" data-string="E-Fatura" string="E-Fatura" data-key="efatura">
                    <h2>E-Fatura Entegrasyonu</h2>
                    <div class="row mt16 o_settings_container">
                        <!-- E-Fatura SOAP AyarlarÄ± -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_right_pane">
                                <label for="efatura_username" string="E-Fatura SOAP Servisi"/>
                                <div class="text-muted">
                                    E-fatura SOAP servisi baÄŸlantÄ± bilgileri
                                </div>
                                <div class="content-group">
                                    <div class="mt16">
                                        <field name="efatura_username" placeholder="KullanÄ±cÄ± adÄ±"/>
                                    </div>
                                    <div class="mt8">
                                        <field name="efatura_password" placeholder="Åžifre" password="True"/>
                                    </div>
                                    <div class="mt8">
                                        <button name="action_test_efatura_connection" type="object" 
                                                string="E-Fatura BaÄŸlantÄ±sÄ±nÄ± Test Et" class="btn-secondary"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Logo MSSQL AyarlarÄ± -->
                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="logo_auto_sync"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="logo_auto_sync" string="Logo Otomatik Senkronizasyon"/>
                                <div class="text-muted">
                                    E-fatura senkronizasyonu sonrasÄ± otomatik Logo senkronizasyonu
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6 o_setting_box">
                            <div class="o_setting_right_pane">
                                <label for="logo_mssql_server" string="Logo MSSQL BaÄŸlantÄ±sÄ±"/>
                                <div class="text-muted">
                                    Logo veritabanÄ± baÄŸlantÄ± bilgileri
                                </div>
                                <div class="content-group">
                                    <div class="row">
                                        <div class="col-8">
                                            <field name="logo_mssql_server" placeholder="Server adÄ± veya IP"/>
                                        </div>
                                        <div class="col-4">
                                            <field name="logo_mssql_port" placeholder="Port"/>
                                        </div>
                                    </div>
                                    <div class="mt8">
                                        <field name="logo_mssql_database" placeholder="VeritabanÄ± adÄ±"/>
                                    </div>
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <field name="logo_mssql_username" placeholder="KullanÄ±cÄ± adÄ±"/>
                                        </div>
                                        <div class="col-6">
                                            <field name="logo_mssql_password" placeholder="Åžifre" password="True"/>
                                        </div>
                                    </div>
                                    <div class="mt8">
                                        <field name="logo_invoice_table" placeholder="Fatura tablosu adÄ±"/>
                                        <div class="text-muted mt4">
                                            Ã–rnek: LG_600_01_INVOICE, LG_001_01_INVOICE
                                        </div>
                                    </div>
                                    <div class="mt8">
                                        <button name="action_test_logo_connection" type="object" 
                                                string="Logo BaÄŸlantÄ±sÄ±nÄ± Test Et" class="btn-secondary"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cron AyarlarÄ± -->
                    <h3 class="mt32">Otomatik Senkronizasyon Cron AyarlarÄ±</h3>
                    <div class="row mt16 o_settings_container">
                        <!-- Cron 1: Progressive Sync -->
                        <div class="col-12 col-lg-12 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="cron1_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="cron1_enabled" string="Progressive Sync (7 GÃ¼nlÃ¼k Periyotlar)"/>
                                <div class="text-muted">
                                    Belirtilen tarih aralÄ±ÄŸÄ±nda 7 gÃ¼nlÃ¼k periyotlarla e-fatura ve e-arÅŸiv senkronizasyonu
                                </div>
                                <div class="content-group" invisible="cron1_enabled == False">
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron1_start_date" string="BaÅŸlangÄ±Ã§ Tarihi"/>
                                            <field name="cron1_start_date" placeholder="YYYY-MM-DD"/>
                                        </div>
                                        <div class="col-6">
                                            <label for="cron1_end_date" string="BitiÅŸ Tarihi"/>
                                            <field name="cron1_end_date" placeholder="YYYY-MM-DD"/>
                                        </div>
                                    </div>
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron1_last_sync_date" string="Son Senkronize Tarih"/>
                                            <field name="cron1_last_sync_date" readonly="1" placeholder="YYYY-MM-DD"/>
                                        </div>
                                        <div class="col-6">
                                            <button name="action_reset_progressive_sync" type="object"
                                                    string="SÄ±fÄ±rla" class="btn-secondary"
                                                    help="Son senkronize tarihi sÄ±fÄ±rla ve baÅŸtan baÅŸla"/>
                                        </div>
                                    </div>
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron1_start_hour" string="Ã‡alÄ±ÅŸma BaÅŸlangÄ±Ã§ Saati"/>
                                            <field name="cron1_start_hour"/>
                                        </div>
                                        <div class="col-6">
                                            <label for="cron1_end_hour" string="Ã‡alÄ±ÅŸma BitiÅŸ Saati"/>
                                            <field name="cron1_end_hour"/>
                                        </div>
                                    </div>
                                    <div class="text-info mt8">
                                        <i class="fa fa-info-circle"/> 10 dakikada bir kontrol eder, sadece Ã§alÄ±ÅŸma saatleri iÃ§inde iÅŸlem yapar.
                                        BitiÅŸ tarihine ulaÅŸtÄ±ÄŸÄ±nda baÅŸlangÄ±Ã§ tarihine dÃ¶ner.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cron 2: Retrospective Sync -->
                        <div class="col-12 col-lg-12 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="cron2_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="cron2_enabled" string="Retrospective Sync (Geriye DÃ¶nÃ¼k)"/>
                                <div class="text-muted">
                                    Belirtilen gÃ¼n sayÄ±sÄ± kadar Ã¶nceki gÃ¼nÃ¼n faturalarÄ±nÄ± senkronize et
                                </div>
                                <div class="content-group" invisible="cron2_enabled == False">
                                    <div class="row mt8">
                                        <div class="col-12">
                                            <label for="cron2_days_ago" string="KaÃ§ GÃ¼n Ã–nce"/>
                                            <field name="cron2_days_ago"/>
                                            <div class="text-muted mt4">
                                                Ã–rnek: 3 girilirse, her Ã§alÄ±ÅŸtÄ±ÄŸÄ±nda 3 gÃ¼n Ã¶nceki faturalar senkronize edilir.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron2_start_hour" string="Ã‡alÄ±ÅŸma BaÅŸlangÄ±Ã§ Saati"/>
                                            <field name="cron2_start_hour"/>
                                        </div>
                                        <div class="col-6">
                                            <label for="cron2_end_hour" string="Ã‡alÄ±ÅŸma BitiÅŸ Saati"/>
                                            <field name="cron2_end_hour"/>
                                        </div>
                                    </div>
                                    <div class="text-info mt8">
                                        <i class="fa fa-info-circle"/> 10 dakikada bir kontrol eder, sadece Ã§alÄ±ÅŸma saatleri iÃ§inde iÅŸlem yapar.
                                        SÃ¼rekli Ã§alÄ±ÅŸÄ±r, bitiÅŸ tarihi yoktur.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cron 3: Logo Monthly Sync -->
                        <div class="col-12 col-lg-12 o_setting_box">
                            <div class="o_setting_left_pane">
                                <field name="cron3_enabled"/>
                            </div>
                            <div class="o_setting_right_pane">
                                <label for="cron3_enabled" string="Logo Monthly Sync (AylÄ±k Periyotlar)"/>
                                <div class="text-muted">
                                    Belirtilen tarih aralÄ±ÄŸÄ±nda aylÄ±k (30 gÃ¼nlÃ¼k) periyotlarla Logo senkronizasyonu
                                </div>
                                <div class="content-group" invisible="cron3_enabled == False">
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron3_start_date" string="BaÅŸlangÄ±Ã§ Tarihi"/>
                                            <field name="cron3_start_date" placeholder="YYYY-MM-DD"/>
                                        </div>
                                        <div class="col-6">
                                            <label for="cron3_end_date" string="BitiÅŸ Tarihi"/>
                                            <field name="cron3_end_date" placeholder="YYYY-MM-DD"/>
                                        </div>
                                    </div>
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron3_last_sync_date" string="Son Senkronize Tarih"/>
                                            <field name="cron3_last_sync_date" readonly="1" placeholder="YYYY-MM-DD"/>
                                        </div>
                                        <div class="col-6">
                                            <button name="action_reset_logo_monthly_sync" type="object"
                                                    string="SÄ±fÄ±rla" class="btn-secondary"
                                                    help="Son senkronize tarihi sÄ±fÄ±rla ve baÅŸtan baÅŸla"/>
                                        </div>
                                    </div>
                                    <div class="row mt8">
                                        <div class="col-6">
                                            <label for="cron3_start_hour" string="Ã‡alÄ±ÅŸma BaÅŸlangÄ±Ã§ Saati"/>
                                            <field name="cron3_start_hour"/>
                                        </div>
                                        <div class="col-6">
                                            <label for="cron3_end_hour" string="Ã‡alÄ±ÅŸma BitiÅŸ Saati"/>
                                            <field name="cron3_end_hour"/>
                                        </div>
                                    </div>
                                    <div class="text-info mt8">
                                        <i class="fa fa-info-circle"/> 10 dakikada bir kontrol eder, sadece Ã§alÄ±ÅŸma saatleri iÃ§inde iÅŸlem yapar.
                                        AylÄ±k (30 gÃ¼nlÃ¼k) periyotlarla Logo ile senkronizasyon yapar. BitiÅŸ tarihine ulaÅŸtÄ±ÄŸÄ±nda durur.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </xpath>
        </field>
    </record>
    
    <!-- Configuration Action -->
    <record id="action_e_invoice_config" model="ir.actions.act_window">
        <field name="name">E-Fatura AyarlarÄ±</field>
        <field name="res_model">res.config.settings</field>
        <field name="view_mode">form</field>
        <field name="target">inline</field>
        <field name="context">{'module': 'tss_guven_muhasebe'}</field>
    </record>


</odoo>